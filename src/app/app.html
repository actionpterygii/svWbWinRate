<main class="main">
  <div style="display: flex; justify-content: center; margin-top: 2em;">
    <mat-card style="width: 100%; max-width: 1000px; padding: 1em;">
      <div style="display: flex; gap: 1em; align-items: center; margin-bottom: 1em;">
        <div class="toolbar-buttons">
          <button mat-raised-button color="primary" (click)="exportYaml()">
            <mat-icon>download</mat-icon>
            エクスポート
          </button>
          <button mat-raised-button color="accent" (click)="fileInput.click()">
            <mat-icon>upload</mat-icon>
            インポート(上書き)
          </button>
          <input #fileInput type="file" accept=".yml,.yaml" (change)="importYaml($event)" style="display:none;">
          <button mat-raised-button color="primary" (click)="addTab()">
            <mat-icon>add</mat-icon>
            デッキ追加
          </button>
          <button mat-raised-button color="primary" (click)="addCounter()">
            <mat-icon>add</mat-icon>
            カウンター追加
          </button>
          <button mat-raised-button color="warn" (click)="resetAll()">
            <mat-icon>restart_alt</mat-icon>
            初期化
          </button>
          <button mat-stroked-button color="primary" (click)="openHowToDialog()">
            <mat-icon>help_outline</mat-icon>
            使い方
          </button>
        </div>
      </div>

      <!-- ↓↓↓ ここをカードからmat-toolbarに変更 ↓↓↓ -->
      <mat-toolbar color="primary" style="margin-bottom: 1em; border-radius: 8px;">
        <span style="font-weight: bold;">全体合計</span>
        <span style="margin-left: 2em;">勝率: {{ totalRate }}%</span>
        <span style="margin-left: 2em;">{{ totalWin }}勝</span>
        <span style="margin-left: 2em;">{{ totalLose }}敗</span>
      </mat-toolbar>
      <mat-divider></mat-divider>

      <mat-tab-group [(selectedIndex)]="activeTab" style="margin-bottom: 1em;">
        <mat-tab *ngFor="let set of counterSets; let i = index">
          <ng-template mat-tab-label>
            <span style="font-weight: bold; font-size: 1.1em;">{{ set.name }}</span>
            <button mat-icon-button color="warn" (click)="removeTab(i); $event.stopPropagation()">
              <mat-icon>delete</mat-icon>
            </button>
          </ng-template>
          <mat-toolbar style="margin-top: 1em; margin-bottom: 1em; border-radius: 8px; background-color: white;">
            <div style="display: flex; gap: 2em; align-items: center;">
              <b>デッキ合計</b>
              <span>勝率: {{ tabRate(i) }}%</span>
              <span>{{ tabWin(i) }}勝</span>
              <span>{{ tabLose(i) }}敗</span>
            </div>
          </mat-toolbar>
          <!-- 横スクロール対応ラッパーを追加 -->
          <div class="counter-list-outer">
            <div
              class="counter-list-inner"
              style="padding-top: 0.5em; padding-bottom: 0.5em; display: flex; flex-direction: column;">
              <div *ngFor="let c of counterSets[i].counters; let j = index">
                <app-counter
                  [title]="c.title"
                  [win]="c.win"
                  [lose]="c.lose"
                  [storageKey]="c.storageKey"
                  (remove)="removeCounter(j)"
                  (dragStart)="onDragStart(j, $event)"
                  (dragOver)="onDragOver(j)">
                </app-counter>
              </div>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
      <mat-divider></mat-divider>
      <div style="text-align: center; margin-top: 2em;">
        <a
          href="https://www.actionpterygii.com/"
          target="_blank"
          rel="noopener"
          style="color: #33cccc; text-decoration: underline; font-family: monospace; font-size: 16px;"
        >
          actionpterygii
        </a>
      </div>
    </mat-card>
  </div>
</main>

<router-outlet />